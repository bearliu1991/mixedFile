webpackJsonp([17],{E1P5:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("BO1k"),i=r.n(n),a=r("Gu7T"),o=r.n(a),s={name:"ContractStatistic",data:function(){return{categoryList:[],pastDays:0}},created:function(){this.getUsers()},methods:{moveIconShow:function(t,e,r){var n=this.categoryList.filter(function(t){return t.parentId===e.parentId});if(n&&n.length){if(r){if(e.order===n[0].order)return!1}else if(e.order===n[n.length-1].order)return!1;return!0}return!1},addRow:function(t,e){if(void 0===e.id)return this.$message.error("添加子账号前先保存"),!1;var r={};this.$set(e,"isSpread",!0);var n=this.categoryList.filter(function(t){return t.parentId===e.id});n&&n.length?(n.sort(function(t,e){return e.order-t.order}),r={name:"",parentId:e.id,hasChildren:!1,isSpread:!0,level:2,order:n[0].order+1},this.categoryList.splice(t+n.length+1,0,r)):(r={name:"",parentId:e.id,hasChildren:!1,isSpread:!0,level:2,order:0},this.categoryList.splice(t+1,0,r))},_processLevelStatisticData:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];0===n.parentId&&(n.level=1,n.hasChildren=!0,e.push(n),this._loadChildrenData(e,t,n,2))}return e},_loadChildrenData:function(t,e,r,n){for(var i=0;i<e.length;i++){var a=e[i];a.parentId===r.id&&(a.level=n,a.isSpread=!1,t.push(a))}},move:function(t,e,r){var n=this,i=[],a={startId:e.id},s=(i=0===e.parentId?this.categoryList.filter(function(t){return 0===t.parentId}):this.categoryList.filter(function(t){return t.parentId===e.parentId})).findIndex(function(t){return t.id===e.id}),c=r?i[s-1]:i[s+1];a.endId=c.id,this.$postJson(this._basePath.ajaxMoveCategory,a).then(function(i){if(i.success)if(n.$message.success("移动成功"),0===e.parentId){var a,s,d=n.categoryList.findIndex(function(t){return t.id===c.id}),l=n.categoryList.filter(function(t){return t.parentId===e.id}),u=n.categoryList.filter(function(t){return t.parentId===c.id});if(r)(a=n.categoryList).splice.apply(a,[d,0,e].concat(o()(l))),n.categoryList.splice(t+l.length+1,l.length+1);else(s=n.categoryList).splice.apply(s,[d+u.length+1,0,e].concat(o()(l))),n.categoryList.splice(t,l.length+1)}else r?(n.categoryList.splice(t-1,0,n.categoryList[t]),n.categoryList.splice(t+1,1)):(n.categoryList.splice(t,0,n.categoryList[t+1]),n.categoryList.splice(t+2,1))})},getUsers:function(){var t=this;this.$post(this._basePath.ajaxCategoryGetPage).then(function(e){var r=e.data;if(r&&r.length){r.sort(function(t,e){return t.order-e.order});var n=t._processLevelStatisticData(r),a=n.filter(function(t){return 0===t.parentId}),o=function(t){t.isSpread&&n.forEach(function(e){e.parentId===t.id&&(e.isSpread=!0)})},s=!0,c=!1,d=void 0;try{for(var l,u=i()(a);!(s=(l=u.next()).done);s=!0){o(l.value)}}catch(t){c=!0,d=t}finally{try{!s&&u.return&&u.return()}finally{if(c)throw d}}t.categoryList=n}})},addCategory:function(){var t=this._deepCopy(this.categoryList),e=0;if(t.length){var r=this.categoryList.filter(function(t){return 0===t.parentId});t.sort(function(t,e){return e.id-t.id}),t[0].id,r.sort(function(t,e){return e.order-t.order}),e=r[0].order}var n=[{name:"",parentId:0,order:e+1,hasChildren:!0,isSpread:!1,level:1}];this.categoryList=this.categoryList.concat(n)},saveData:function(t,e){var r=this;if(!e.name)return this.$message.error("分类名不能为空"),!1;var n=0,i=[];this.categoryList.length&&((i=this.categoryList.filter(function(t){return t.parentId===e.parentId})).sort(function(t,e){return e.order-t.order}),n=i[0].order);var a={isSpread:e.isSpread,name:e.name,parentId:e.parentId,order:n};void 0!==e.id&&(a.id=e.id,a.order=e.order),this.$post(this._basePath.ajaxCategoryPartSave,a).then(function(n){if(n.success){r.$message({message:"保存成功",type:"success"});var i=n.data;i.level=0===e.parentId?1:2,r.$set(r.categoryList,t,i)}})},batchRemove:function(t){var e=this;this.$confirm("删除该分类后将解除商品与该分类的关系，确定删除？","提示",{type:"warning"}).then(function(){var r=e.categoryList,n={idList:t.id.toString()};e.$postJson(e._basePath.ajaxCategoryDel,n).then(function(n){if(n.success){if(e.$message.success("删除成功"),0===t.parentId)r=r.filter(function(e){return e.parentId!==t.id&&e.id!==t.id});else{var i=r.findIndex(function(e){return e.id===t.id});r.splice(i,1)}e.categoryList=r}})}).catch(function(){})},rowClassNameHandler:function(t){var e=t.row,r=(t.rowIndex,"pid-"+e.parentId);return 0!==e.parentId&&!0!==e.isSpread&&(r+=" hiddenRow"),r},onExpand:function(t){this.$set(t,"isSpread",!t.isSpread),this.categoryList.forEach(function(e){e.parentId===t.id&&(e.isSpread=t.isSpread)}),this.categoryList=this.categoryList}}},c={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"common-content",attrs:{id:"category_manage"}},[r("div",{staticClass:"process_btns",staticStyle:{"margin-bottom":"20px"}},[r("el-button",{attrs:{type:"primary"},on:{click:t.addCategory}},[t._v("添加分类")])],1),t._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.categoryList,border:"",size:"medium","row-class-name":t.rowClassNameHandler,"highlight-current-row":""}},[r("el-table-column",{attrs:{label:"分类名称",width:"460",align:"left","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",{staticClass:"icon",style:{marginLeft:30*e.row.level+"px"}}),t._v(" "),e.row.isSpread&&1===e.row.level?r("i",{staticClass:"icon",class:{"fa fa-folder-open":e.row.isSpread,"fa fa-file-o":!e.row.hasChildren},style:{cursor:e.row.hasChildren?"pointer":"normal"},on:{click:function(r){t.onExpand(e.row)}}},[t._v("")]):t._e(),t._v(" "),e.row.isSpread||1!==e.row.level?t._e():r("i",{staticClass:"icon",class:{"fa fa-folder":e.row.hasChildren,"fa fa-file-o":!e.row.hasChildren},style:{cursor:e.row.hasChildren?"pointer":"normal"},on:{click:function(r){t.onExpand(e.row)}}},[t._v("")]),t._v(" "),e.row.isAdd?t._e():r("el-input",{staticStyle:{width:"200px"},attrs:{size:"mini"},model:{value:e.row.name,callback:function(r){t.$set(e.row,"name",r)},expression:"scope.row.name"}})]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"操作",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isAdd||void 0===e.row.id?t._e():r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(r){t.batchRemove(e.row)}}},[t._v("删除")]),t._v(" "),e.row.isAdd||void 0!==e.row.id?t._e():r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){t.saveData(e.$index,e.row)}}},[t._v("保存")]),t._v(" "),e.row.isAdd||void 0===e.row.id?t._e():r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){t.saveData(e.$index,e.row)}}},[t._v("修改")]),t._v(" "),0===e.row.parentId&&void 0!==e.row.id?r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){t.addRow(e.$index,e.row)}}},[t._v("添加子分类")]):t._e(),t._v(" "),void 0!==e.row.id&&t.moveIconShow(e.$index,e.row,!0)?r("el-button",{staticClass:"icon move_icon",attrs:{type:"info",size:"mini"},on:{click:function(r){t.move(e.$index,e.row,!0)}}},[t._v("")]):t._e(),t._v(" "),void 0!==e.row.id&&t.moveIconShow(e.$index,e.row)?r("el-button",{staticClass:"icon move_icon",attrs:{type:"info",size:"mini"},on:{click:function(r){t.move(e.$index,e.row)}}},[t._v("")]):t._e()]}}])})],1),t._v(" "),r("div",{staticStyle:{"margin-top":"20px","text-align":"center"}})],1)},staticRenderFns:[]};var d=r("VU/8")(s,c,!1,function(t){r("P4nV")},null,null);e.default=d.exports},P4nV:function(t,e,r){var n=r("oEFI");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);r("rjj0")("55a6db5c",n,!0)},oEFI:function(t,e,r){(t.exports=r("FZ+f")(!1)).push([t.i,"\n#category_manage {\n  padding: 10px;\n}\n#category_manage .move_icon span {\n  font-size: 1px;\n}\n#category_manage .hiddenRow {\n  display: none;\n}\n#category_manage .searchForm {\n  padding: 10px;\n}\n#category_manage .searchForm span.label {\n  margin-right: 10px;\n}\n#category_manage .searchForm span.attention {\n  color: #e50021;\n}\n",""])}});