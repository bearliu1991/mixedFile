webpackJsonp([8],{FPWf:function(e,t,a){var s=a("y7YU");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("f5cf8576",s,!0)},abps:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),o=a.n(s),r=a("woOf"),i=a.n(r),n={data:function(){return{secShow:!1,dialogStatus:"create",textMap:{update:"编辑颜色",create:"新增颜色"},siteType:"0",status:"0",colorDefault:null,users:[],stallList:[],total:0,pageNum:1,pageSize:10,sels:[],advFormRules:{imgUrl:[{required:!0,validator:this.noEmpty,message:"banner图必须存在",trigger:"blur"}]},avails:[{name:"正在使用",status:0},{name:"已禁用",status:1}],advPositions:[{name:"首页顶部轮播广告",siteType:0},{name:"首页中间固定广告",siteType:1},{name:"首页商品列表广告",siteType:2}],advTypes:[{name:"全部",filters:{}},{name:"跳转链接",filters:{advType:0}},{name:"跳转商品",filters:{advType:1}},{name:"跳转店铺",filters:{advType:2}}],platformType:[{name:"pc商城",value:"PC"},{name:"微信小程序",value:"WX"}],advForm:{type:0,imgUrl:"",status:0,url:"",plateformType:"WX",siteType:0},shopForm:{name:""},goodForm:{productCode:""},linkForm:{url:""},choosedShop:{},choosedProduct:{},shopList:[],productList:[],loading:!1}},mounted:function(){this.getUsers()},methods:{formatTime:function(e){return this._formatTime(e.createTime)},formatPosition:function(e){return this.advPositions.find(function(t){return t.siteType===e.siteType}).name},formatType:function(e){return this.advTypes.find(function(t){return t.filters.advType===e.type}).name},queryData:function(){this.pageNum=1,this.getUsers()},formatStatus:function(e){return 1===e.status?"开启":"禁用"},moveDown:function(e,t){var a=this,s={moveId:this.users[e].id,unMoveId:this.users[t?e+1:e-1].id};this.$postJson(this._basePath.ajaxMoveBanner,s).then(function(e){e.success&&(a.$message.success("移动成功"),a.getUsers())})},handleCurrentChange:function(e){this.pageNum=e,this.getUsers()},setImgList:function(e){this.$set(this.advForm,"imgUrl",e[0])},searchShop:function(e){var t=this;this.$refs.shopForm.validate(function(e){if(e){var a={name:t.shopForm.name};t.loading=!0,t.$postJson(t._basePath.ajaxFilterShop,a).then(function(e){t.loading=!1,e.success&&(t.shopList=e.data,t.choosedShop={value:t.shopList[0].id})})}})},searchGood:function(e){var t=this;if(void 0===this.choosedShop.value)return this.$message.error("请先选择档口"),!1;this.$refs.goodForm.validate(function(e){if(e){var a={pageNum:1,pageSize:999,saleState:1,orderByUpdateTime:!0,stallId:t.choosedShop.value,productCode:t.goodForm.productCode};t.loading=!0,t.$postJson(t._basePath.ajaxBannerGoods,a).then(function(e){t.loading=!1,e.success&&t.productList&&t.productList.length&&(t.productList=e.data,t.choosedProduct={value:t.productList[0].id})})}})},batchRemove:function(e){var t=this,a=e?[e.id]:this.sels.map(function(e){return e.id});this.$confirm("确认删除选中记录吗？","提示",{type:"warning"}).then(function(){var e={idList:a.toString()};t.$postJson(t._basePath.ajaxDelBanner,e).then(function(e){e.success&&(t.$message({message:"删除成功",type:"success"}),t.getUsers())})}).catch(function(){})},getUsers:function(){var e=this,t={pageNum:this.pageNum,pageSize:this.pageSize,status:this.status-0,siteType:this.siteType-0};this.$refs.filterBtn&&(t.type=this.$refs.filterBtn.getParams().advType),this.loading=!0,this.$postJson(this._basePath.ajaxGetBannerByPage,t).then(function(t){e.loading=!1,t.success&&(e.total=t.data.count,e.users=t.data.datas)})},showAddBusiness:function(){this.secShow=!0,this.dialogstatus="create",this.advForm={type:0,imgUrl:"",status:0,url:"",plateformType:"WX",siteType:0}},editData:function(e){var t=this;this.$postJson(this._basePath.ajaxBannerDetail,{id:e.id}).then(function(e){if(e.success){var a=e.data;t.secShow=!0,t.dialogstatus="update",t.advForm=i()({},a),0===t.advForm.type?t.linkForm={url:a.url}:2===t.advForm.type?(t.choosedShop={value:a.bizId},t.shopList=[{id:a.bizId,name:a.stallName}],t.shopForm={name:a.stallName}):1===t.advForm.type&&(t.choosedShop={value:a.stallId},t.shopList=[{id:a.stallId,name:a.stallName}],t.shopForm={name:a.stallName},t.choosedProduct={value:a.bizId},t.productList=[{id:a.bizId,title:a.title}],t.goodForm={productCode:a.productCode})}})},saveBanner:function(){var e=this;this.$refs.advForm.validate(function(t){if(t){var a=o()({},e.advForm);if(a.url=e.linkForm.url,2===e.advForm.type){if(void 0===e.choosedShop.value)return e.$message.error("请选择店铺"),!1;a.bizId=e.choosedShop.value}else if(1===e.advForm.type){if(void 0===e.choosedProduct.value)return e.$message.error("请选择商品"),!1;a.bizId=e.choosedProduct.value}e.$post(e._basePath.ajaxEitBanner,a).then(function(t){t.success&&(e.$message.success("操作成功"),e.getUsers(),e.secShow=!1)})}})},selsChange:function(e){this.sels=e}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"app-container",attrs:{id:"areaList"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.secShow,expression:"!secShow"}]},[a("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[a("div",{staticClass:"process_btns"},[a("el-button",{attrs:{type:"primary"},on:{click:e.showAddBusiness}},[e._v("新增banner")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.batchRemove()}}},[e._v("批量删除")])],1),e._v(" "),a("el-tabs",{staticClass:"switch_btn",on:{"tab-click":e.getUsers},model:{value:e.siteType,callback:function(t){e.siteType=t},expression:"siteType"}},e._l(e.advPositions,function(e,t){return a("el-tab-pane",{key:t,attrs:{label:e.name,name:e.siteType+""}})})),e._v(" "),a("el-tabs",{staticClass:"switch_btn",on:{"tab-click":e.getUsers},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.avails,function(e,t){return a("el-tab-pane",{key:t,attrs:{label:e.name,name:e.status+""}})})),e._v(" "),a("filter-list",{ref:"filterBtn",attrs:{filterList:e.advTypes,title:"广告类型"},on:{filterChange:e.queryData}})],1),e._v(" "),a("record-count",{attrs:{total:e.total}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.users,"highlight-current-row":""},on:{"selection-change":e.selsChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",formatter:e.formatTime}}),e._v(" "),a("el-table-column",{attrs:{prop:"code",label:"广告位置",formatter:e.formatPosition}}),e._v(" "),a("el-table-column",{attrs:{prop:"logo",label:"banner图"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{attrs:{width:"60px",height:"60px",src:e.row.imgUrl}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"类型",formatter:e.formatType}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"320px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(a){e.editData(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"success",plain:"",size:"mini"},on:{click:function(a){e.batchRemove(t.row)}}},[e._v("删除")]),e._v(" "),e.status-0==0?[t.$index<e.users.length-1?a("el-button",{staticClass:"downforward forward_icon icon",attrs:{size:"mini",type:"text"},on:{click:function(a){e.moveDown(t.$index,!0)}}},[e._v("下移")]):e._e(),e._v(" "),t.$index>0?a("el-button",{staticClass:"upforward forward_icon icon",attrs:{size:"mini",type:"text"},on:{click:function(a){e.moveDown(t.$index,!1)}}},[e._v("上移")]):e._e()]:e._e()]}}])})],1),e._v(" "),a("div",{staticClass:"page_toolbar"},[a("el-pagination",{attrs:{layout:"prev, pager, next, jumper","prev-text":"上一页","next-text":"下一页",background:"","page-size":e.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("Secondary",{attrs:{title:e.textMap[e.dialogStatus]},model:{value:e.secShow,callback:function(t){e.secShow=t},expression:"secShow"}},[e.secShow?a("el-form",{ref:"advForm",staticClass:"secondary_form",staticStyle:{width:"800px"},attrs:{model:e.advForm,"label-width":"120px",rules:e.advFormRules}},[a("el-form-item",{attrs:{label:"广告位置",prop:"siteType"}},[a("el-select",{attrs:{placeholder:"请选择广告位置"},model:{value:e.advForm.siteType,callback:function(t){e.$set(e.advForm,"siteType",t)},expression:"advForm.siteType"}},e._l(e.advPositions,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.siteType}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"banner图片",prop:"imgUrl"}},[a("good-img-upload",{attrs:{imgUrl_main:e.advForm.imgUrl,isGroup:!1,mainTitle:"banner图"},on:{uploadImg:e.setImgList}})],1),e._v(" "),a("el-form-item",{attrs:{label:"广告类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择广告类型"},model:{value:e.advForm.type,callback:function(t){e.$set(e.advForm,"type",t)},expression:"advForm.type"}},e._l(e.advTypes.slice(1),function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.filters.advType}})}))],1),e._v(" "),e._isHave(e.advForm.type,[1,2])?a("el-form-item",{attrs:{label:"店铺选择"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{ref:"shopForm",staticClass:"set_start",attrs:{model:e.shopForm}},[a("el-form-item",{staticStyle:{"margin-right":"10px","margin-bottom":"0"},attrs:{prop:"name",rules:[{required:!0,validator:e.noEmpty,message:"不能为空"}]}},[a("el-input",{attrs:{placeholder:"档口名称"},model:{value:e.shopForm.name,callback:function(t){e.$set(e.shopForm,"name",t)},expression:"shopForm.name"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchShop},slot:"append"})],1)],1),e._v(" "),a("el-select",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{placeholder:"请选择档口"},model:{value:e.choosedShop.value,callback:function(t){e.$set(e.choosedShop,"value",t)},expression:"choosedShop.value"}},e._l(e.shopList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)]}}])}):e._e(),e._v(" "),e._isHave(e.advForm.type,[1])?a("el-form-item",{attrs:{label:"商品选择"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{ref:"goodForm",staticClass:"set_start",attrs:{model:e.goodForm}},[a("el-form-item",{staticStyle:{"margin-right":"10px","margin-bottom":"0"},attrs:{prop:"productCode",rules:[{required:!0,validator:e.noEmpty,message:"不能为空"}]}},[a("el-input",{attrs:{placeholder:"商品货号"},model:{value:e.goodForm.productCode,callback:function(t){e.$set(e.goodForm,"productCode",t)},expression:"goodForm.productCode"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchGood},slot:"append"})],1)],1),e._v(" "),a("el-select",{staticStyle:{width:"400px"},attrs:{placeholder:"请选择商品"},model:{value:e.choosedProduct.value,callback:function(t){e.$set(e.choosedProduct,"value",t)},expression:"choosedProduct.value"}},e._l(e.productList,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}))],1)]}}])}):e._e(),e._v(" "),e._isHave(e.advForm.type,[0])?a("el-form-item",{attrs:{label:"链接地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{ref:"linkForm",attrs:{model:e.linkForm}},[a("el-form-item",{attrs:{label:"",prop:"url",rules:[{required:!0,validator:e.noEmpty,message:"不能为空"}]}},[a("el-input",{attrs:{placeholder:"链接地址"},model:{value:e.linkForm.url,callback:function(t){e.$set(e.linkForm,"url",t)},expression:"linkForm.url"}})],1)],1)]}}])}):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"开启状态"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":0,"inactive-value":1},model:{value:e.advForm.status,callback:function(t){e.$set(e.advForm,"status",t)},expression:"advForm.status"}})],1),e._v(" "),a("el-form-item",[a("el-button",{nativeOn:{click:function(t){e.secShow=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveBanner}},[e._v("保存")])],1)],1):e._e()],1)],1)},staticRenderFns:[]};var c=a("VU/8")(n,l,!1,function(e){a("FPWf")},"data-v-822d1632",null);t.default=c.exports},y7YU:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n#areaList .secondary_form .el-cascader[data-v-822d1632] {\n  width: 100%;\n}\n#areaList .building_title[data-v-822d1632] {\n  margin-top: 10px;\n  margin-bottom: 20px;\n}\n#areaList .building_title i[data-v-822d1632] {\n  font-size: 20px;\n  font-weight: bold;\n}\n#areaList .toolbar_process[data-v-822d1632] {\n  margin-top: 20px;\n}\n",""])}});